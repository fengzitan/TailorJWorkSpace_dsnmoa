$(function(){if(undefined!=page.save&&page.save=="true"){if(undefined!=page.usr){$("#username").val(page.usr)}if(undefined!=page.pwd){$("#password").val(page.pwd)}$("#saveAccount").find(".fa").first().removeClass("fa-square-o").addClass("fa-check-square-o")}$("#username").on("focus",function(){if($(this).val().length>0){$("#usrClearBtn").show()}});$("#username").on("input",function(){if($(this).val().length>0){$("#usrClearBtn").show()}else{$("#usrClearBtn").hide()}});$("#password").on("focus",function(){if($(this).val().length>0){$("#pwdClearBtn").show()}});$("#password").on("input",function(){if($(this).val().length>0){$("#pwdClearBtn").show()}else{$("#pwdClearBtn").hide()}});$("#usrClearBtn").on("click",function(a){var b=$("#username");b.val("");$(this).hide();b.focus()});$("#pwdClearBtn").on("click",function(b){var a=$("#password");a.val("");$(this).hide();a.focus()});$("#saveAccount").on("click",function(){var a=$(this).find(".fa").first();var b=a.hasClass("fa-check-square-o");if(b){a.removeClass("fa-check-square-o").addClass("fa-square-o")}else{a.removeClass("fa-square-o").addClass("fa-check-square-o")}});$(".login-btn").on("click",function(){if(!check()){return}$.ajax({url:TAILOR_BASE_URL+BASE_URL+"/login.do",type:"POST",data:{username:$("#username").val().trim(),password:rsaEncrypt($("#password").val()),saveAccount:$("#saveAccount").find(".fa").first().hasClass("fa-check-square-o")},async:true,dataType:"json",timeout:15000,beforeSend:function(b,a){$(window).scrollTop(0);showLoadingMask({paras:{xhr:b,settings:a},callback:function(c){mAjaxStop(c)}})},success:function(b){if(!b){hideLoadingMask();showMessageDialog(SERVER_RUNTIME_ERROR_MESSAGE)}else{var a=b.data;if(b.success){hideLoadingMask();location.replace(TAILOR_BASE_URL+BASE_URL+"/app/message.do")}else{if(b.expires){pushInPwdChangeView(a.redirect)}else{hideLoadingMask();$("#password").val("");showMessageDialog(a.message)}}}},error:function(c,b,a){hideLoadingMask();if("timeout"==b){showMessageDialog(CONNECTION_TIMEOUT_MESSAGE)}else{if("abort"==b){showMessageDialog(CONNECTION_INTERRUPT_MESSAGE)}}}})});if(SERVICE=="test"){if(""!=MAIL_LOGIN_URL){$("#mLoginBtn").css("display","inline-block");$("#mLoginBtn").on("click",function(){location.replace(TAILOR_BASE_URL+MAIL_LOGIN_URL)})}$("#ehrLoginBtn").css("display","inline-block");$("#ehrLoginBtn").on("click",function(){location.replace(TAILOR_BASE_URL+"http://10.1.16.148:11660/index.jsp")})}});function check(){var b=$("#username");var a=$("#password");if(b.val().length==0||b.val().trim()==""){showMessageDialog("用户名不能为空");b.val("");return false}else{if(a.val().length==0||a.val().trim()==""){showMessageDialog("密码不能为空");a.val("");return false}}return true}function rsaEncrypt(c){var b=page.rsa;if(b){setMaxDigits(b.max);var a=new RSAKeyPair(b.pk,"",b.mod);return encryptedString(a,c,RSAAPP.NoPadding)}else{return c}}function pushInPwdChangeView(b){var a=$("<iframe/>");a.attr("id","PwdChangeView");a.css({position:"absolute",top:0,left:$(window).width()+"px",width:$(window).width()+"px",height:$(window).height()+"px",border:0}).hide();a.attr("src",TAILOR_BASE_URL+b);a.on("load",function(){hideLoadingMask();$(this).show();$(this).addClass("slide-in")});$("body").append(a)}function pushOutPwdChangeView(){var a=$("#PwdChangeView");a.addClass("slide-out");setTimeout(function(){a.remove()},300)};